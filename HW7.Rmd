---
title: "HW7"
author: "Adelia Fida"
date: "11/04/2021"
---
Group Members: Diep Luu,Thakur Ghimire 
```

# We're trying to predict vaccination of hispanic male with highschool and college education. 
model_logit1 <- glm(vaxx ~ AGE_P + I(AGE_P^2) + male + Hispanic + educ_hs + educ_smcoll + educ_as + educ_bach + educ_adv , data = data_use1)

d_region <- data.frame(model.matrix(~ data_use1$REGION))
d_region_born <- data.frame(model.matrix(~ factor(data_use1$region_born)))  # snips any with zero in the subgroup
dat_for_analysis_sub <- data.frame(
  data_use1$vaxx,
  data_use1$AGE_P,
  data_use1$male,
  data_use1$AfAm,
  data_use1$Hispanic,
  data_use1$RaceOther,
  data_use1$Asian,
  data_use1$educ_hs,
  data_use1$educ_smcoll,
  data_use1$educ_as,
  data_use1$educ_bach,
  data_use1$educ_adv,
  data_use1$married,
  data_use1$widowed,
  data_use1$divorc_sep,
  d_region[,2:4],
  d_region_born[,2:12])
names(dat_for_analysis_sub) <- c("vaxx",
                                 "Age",
                                 "male",
                                 "AfAm",
                                 "Hispanic",
                                 "RaceOther",
                                 "Asian",
                                 "educ_hs",
                                 "educ_smcoll",
                                 "educ_as",
                                 "educ_bach",
                                 "educ_adv",
                                 "married",
                                 "widowed",
                                 "divorc_sep",
                                 "Region.Midwest",
                                 "Region.South",
                                 "Region.West",
                                 "born.Mex.CentAm.Carib",
                                 "born.S.Am",
                                 "born.Eur",
                                 "born.f.USSR",
                                 "born.Africa",
                                 "born.MidE",
                                 "born.India.subc",
                                 "born.Mexico",
                                 "born.Spain",
                                 "born.elsewhere",
                                 "born.unknown")
```
```
require("standardize")
set.seed(654321)
NN <- length(dat_for_analysis_sub$vaxx)
restrict_1 <- as.logical(round(runif(NN,min=0,max=0.6))) # use fraction as training data
restrict_1 <- (runif(NN) < 0.1) # use 10% as training data
summary(restrict_1)
   Mode   FALSE    TRUE 
logical  100833   11220 
dat_train <- subset(dat_for_analysis_sub, restrict_1)
dat_test <- subset(dat_for_analysis_sub, !restrict_1)
sobj <- standardize(vaxx ~ Age + male + AfAm + Hispanic + RaceOther + Asian + 
                      educ_hs + educ_smcoll + educ_as + educ_bach + educ_adv + 
                      married + widowed + divorc_sep + 
                      Region.Midwest + Region.South + Region.West + 
                      born.Mex.CentAm.Carib + born.S.Am + born.Eur + born.f.USSR + 
                      born.Africa + born.MidE + born.India.subc + born.Mexico + 
                      born.Spain + born.elsewhere + born.unknown, dat_train, family = binomial)
```
```
# We use this code to predict using the test sets we created and use summary to look at the effect of different variables. This indicates that men are less likely to have vaccination, and African Americas men and Hispanic men are less likely to have vaccination. It even shows that men with advanced degree are less likely to have vaccination.

s_dat_test <- predict(sobj, dat_test)
model_lpm1 <- lm(sobj$formula, data = sobj$data)
summary(model_lpm1)
Call:
lm(formula = sobj$formula, data = sobj$data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.61297 -0.12838 -0.08277 -0.02818  1.04196 

Coefficients:
                        Estimate Std. Error t value Pr(>|t|)    
(Intercept)             0.727911   0.074442   9.778  < 2e-16 ***
Age                    -0.017009   0.004587  -3.708 0.000210 ***
male1                  -0.007195   0.002942  -2.445 0.014496 *  
AfAm1                  -0.011912   0.004393  -2.712 0.006704 ** 
Hispanic1              -0.011946   0.008631  -1.384 0.166354    
RaceOther1              0.062762   0.010463   5.999 2.05e-09 ***
Asian1                  0.014111   0.004589   3.075 0.002111 ** 
educ_hs1                0.041919   0.004495   9.325  < 2e-16 ***
educ_smcoll1            0.025201   0.004867   5.178 2.28e-07 ***
educ_as1                0.025662   0.006105   4.204 2.65e-05 ***
educ_bach1             -0.004483   0.005306  -0.845 0.398202    
educ_adv1              -0.015007   0.006708  -2.237 0.025298 *  
married1               -0.019758   0.004348  -4.544 5.57e-06 ***
widowed1               -0.030269   0.008770  -3.451 0.000560 ***
divorc_sep1             0.008816   0.006337   1.391 0.164174    
Region.Midwest1         0.014089   0.004897   2.877 0.004019 ** 
Region.South1           0.038268   0.004434   8.631  < 2e-16 ***
Region.West1            0.010803   0.004683   2.307 0.021099 *  
born.Mex.CentAm.Carib1  0.150176   0.006269  23.956  < 2e-16 ***
born.S.Am1              0.086226   0.016372   5.267 1.42e-07 ***
born.Eur1               0.023163   0.013233   1.750 0.080074 .  
born.f.USSR1            0.017727   0.032907   0.539 0.590116    
born.Africa1            0.059734   0.017441   3.425 0.000617 ***
born.MidE1              0.063055   0.028634   2.202 0.027676 *  
born.India.subc1        0.039849   0.016065   2.481 0.013132 *  
born.Mexico1            0.034574   0.015979   2.164 0.030501 *  
born.Spain1             0.038399   0.013319   2.883 0.003948 ** 
born.elsewhere1         0.004298   0.023403   0.184 0.854274    
born.unknown1           0.026249   0.029657   0.885 0.376120    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3072 on 11154 degrees of freedom
Multiple R-squared:  0.1108,	Adjusted R-squared:  0.1086 
F-statistic: 49.64 on 28 and 11154 DF,  p-value: < 2.2e-16
```
```
pred_vals_lpm <- predict(model_lpm1, s_dat_test)
pred_model_lpm1 <- (pred_vals_lpm > 0.5)
table(pred = pred_model_lpm1, true = dat_test$vaxx)
       true
pred        0     1
  FALSE 88187 12157
  TRUE    261   265
```
```
model_logit1 <- glm(sobj$formula, family = binomial, data = sobj$data)
summary(model_logit1)
Call:
glm(formula = sobj$formula, family = binomial, data = sobj$data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7804  -0.5018  -0.3986  -0.2632   2.9370  

Coefficients:
                       Estimate Std. Error z value Pr(>|z|)    
(Intercept)             2.69782    0.87347   3.089 0.002011 ** 
Age                    -0.19411    0.05107  -3.801 0.000144 ***
male1                  -0.07271    0.03133  -2.321 0.020308 *  
AfAm1                  -0.09339    0.04789  -1.950 0.051191 .  
Hispanic1              -0.13093    0.10570  -1.239 0.215465    
RaceOther1              0.47154    0.08467   5.569 2.56e-08 ***
Asian1                  0.13459    0.04606   2.922 0.003475 ** 
educ_hs1                0.37334    0.04334   8.615  < 2e-16 ***
educ_smcoll1            0.23167    0.04953   4.677 2.91e-06 ***
educ_as1                0.23206    0.06380   3.637 0.000275 ***
educ_bach1             -0.20639    0.06920  -2.982 0.002861 ** 
educ_adv1              -0.58966    0.12690  -4.647 3.38e-06 ***
married1               -0.18068    0.04531  -3.988 6.67e-05 ***
widowed1               -0.42442    0.12056  -3.521 0.000431 ***
divorc_sep1             0.11064    0.06220   1.779 0.075258 .  
Region.Midwest1         0.18917    0.06143   3.080 0.002073 ** 
Region.South1           0.43674    0.05330   8.194 2.53e-16 ***
Region.West1            0.16924    0.05698   2.970 0.002975 ** 
born.Mex.CentAm.Carib1  0.94692    0.05253  18.025  < 2e-16 ***
born.S.Am1              0.70720    0.12982   5.447 5.11e-08 ***
born.Eur1               0.27642    0.14314   1.931 0.053475 .  
born.f.USSR1            0.14494    0.52524   0.276 0.782591    
born.Africa1            0.57577    0.15597   3.692 0.000223 ***
born.MidE1              0.67806    0.26081   2.600 0.009327 ** 
born.India.subc1        0.48919    0.18127   2.699 0.006963 ** 
born.Mexico1            0.41842    0.18432   2.270 0.023201 *  
born.Spain1             0.43475    0.15039   2.891 0.003841 ** 
born.elsewhere1         0.02772    0.27777   0.100 0.920511    
born.unknown1           0.29552    0.31308   0.944 0.345211    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 8222.7  on 11182  degrees of freedom
Residual deviance: 7160.6  on 11154  degrees of freedom
AIC: 7218.6

Number of Fisher Scoring iterations: 6
```
```
pred_vals <- predict(model_logit1, s_dat_test, type = "response")
pred_model_logit1 <- (pred_vals > 0.5)
table(pred = pred_model_logit1, true = dat_test$vaxx)
       true
pred        0     1
  FALSE 87299 11181
  TRUE   1149  1241
```
```
# We create a data object that is standardized and also divide it into trainding and test sets. Standardization arranges everything on similar scale. 

require(stargazer)
stargazer(model_logit1, type = "text")

==================================================
                           Dependent variable:    
                       ---------------------------
                                  sobj            
--------------------------------------------------
Age                             -0.194***         
                                 (0.051)          
                                                  
male1                         -0.073**          
                                 (0.031)          
                                                  
AfAm1                            -0.093*          
                                 (0.048)          
                                                  
Hispanic1                           -0.131           
                                 (0.106)          
                                                  
RaceOther1                      0.472***          
                                 (0.085)          
                                                  
Asian1                          0.135***          
                                 (0.046)          
                                                  
educ_hs1                        0.373***          
                                 (0.043)          
                                                  
educ_smcoll1                    0.232***          
                                 (0.050)          
                                                  
educ_as1                        0.232***          
                                 (0.064)          
                                                  
educ_bach1                      -0.206***         
                                 (0.069)          
                                                  
educ_adv1                       -0.590***         
                                 (0.127)          
                                                  
married1                        -0.181***         
                                 (0.045)          
                                                  
widowed1                        -0.424***         
                                 (0.121)          
                                                  
divorc_sep1                      0.111*           
                                 (0.062)          
                                                  
Region.Midwest1                 0.189***          
                                 (0.061)          
                                                  
Region.South1                   0.437***          
                                 (0.053)          
                                                  
Region.West1                    0.169***          
                                 (0.057)          
                                                  
born.Mex.CentAm.Carib1          0.947***          
                                 (0.053)          
                                                  
born.S.Am1                      0.707***          
                                 (0.130)          
                                                  
born.Eur1                        0.276*           
                                 (0.143)          
                                                  
born.f.USSR1                      0.145           
                                 (0.525)          
                                                  
born.Africa1                    0.576***          
                                 (0.156)          
                                                  
born.MidE1                      0.678***          
                                 (0.261)          
                                                  
born.India.subc1                0.489***          
                                 (0.181)          
                                                  
born.Mexico1                       0.418**          
                                 (0.184)          
                                                  
born.Spain1                     0.435***          
                                 (0.150)          
                                                  
born.elsewhere1                   0.028           
                                 (0.278)          
                                                  
born.unknown1                     0.296           
                                 (0.313)          
                                                  
Constant                        2.698***          
                                 (0.873)          
                                                  
--------------------------------------------------
Observations                     11,183           
Log Likelihood                 -3,580.288         
Akaike Inf. Crit.               7,218.577         
==================================================
Note:                  *p<0.1; **p<0.05; ***p<0.01
```
```
require(e1071)
svm.model <- svm(as.factor(vaxx) ~ ., data = sobj$data, cost = 10, gamma = 0.1)
svm.pred <- predict(svm.model, s_dat_test)
table(pred = svm.pred, true = dat_test$vaxx)
    true
pred     0     1
   0 86565 10432
   1  1883  1990
```
